<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Exclusive Promocode</title>
	<link href="https://fonts.googleapis.com/css?family=Heebo:400,500,700|Fira+Sans:600" rel="stylesheet">
	<link rel="stylesheet" href="homepage_files/css/style.css">
	<script src="https://unpkg.com/animejs@2.2.0/anime.min.js"></script>
	<script src="https://unpkg.com/scrollreveal@4.0.0/dist/scrollreveal.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="is-boxed has-animations">
	<div class="body-wrap boxed-container">
		<main>
			<section class="hero">
				<div class="container body">
					<div class="hero-inner">
						<div class="hero-copy">
							<img class="logo-img" src="homepage_files/images/logo.png" />
							<h1 class="hero-title mt-0">The Best Deals on a Daily Basis</h1>
							<p class="hero-paragraph">Check out these exclusive offers and deals while we CONFIRM your registration.</p>
							<div class="hero-form field field-grouped">
								<div class="control control-expanded">
									<input id="email-input" class="input" type="email" name="email" placeholder="Your best email&hellip;">
								</div>
								<div class="control">
									<button id="email-register-btn" class="button button-primary button-block">Early access</button>
								</div>
							</div>
							<span id="error-msg" style="display: block; margin-top: 10px;"></span>
							<span id="success-msg" style="display: block; margin-top: 10px;"></span>
						</div>
						<div class="hero-illustration">
						</div>
					</div>
				</div>
			</section>
		</main>
		<footer class="site-footer">
			<div class="container">
				<div class="site-footer-inner has-top-divider">
					<div class="brand footer-brand">
						<div class="footer-copyright">&copy; 2020 All Rights Reserved.
							This is an independent survey and marketing website which is not affiliated with or endorsed
							by Online or any online retailer or brand. This website does not claim to represent or own
							any of the trademarks, tradenames or rights associated with any of the offers which are the
							property of their respective owners who do not own, endorse, or promote this website. All
							images on this website are readily available in various places on the Internet and believed
							to be in public domain according to the U.S. Copyright Fair Use Act. Offer shipping and
							handling fees may apply. *See manufacturer's site for details as terms may vary with offers.
							This website receives compensation in exchange for promoting third party offers. See
							important terms and conditions regarding this survey, site, and advertisement here.</div>
					</div>
				</div>
		</footer>
	</div>

	<script>
	document.getElementById("email-register-btn").addEventListener("click", async function(event) {
		event.preventDefault(); // Empêche la redirection du lien

		console.log("Button clicked");

		let emailInput = document.getElementById("email-input");
		let email = emailInput.value.trim();
		let errorMsg = document.getElementById("error-msg");
		let successMsg = document.getElementById("success-msg");
		let url = window.location.href;

		errorMsg.textContent = "";
		successMsg.textContent = "";

		// Fonction de validation d'email
		function isValidEmail(email) {
			let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			return emailRegex.test(email);
		}

		// Vérification de l'email
		if (!email) {
			errorMsg.textContent = "Please enter an email address.";
			errorMsg.style.display = "block";
			errorMsg.style.color = "red";
			return;
		}

		if (!isValidEmail(email)) {
			errorMsg.textContent = "Invalid email format. Please enter a valid email.";
			errorMsg.style.display = "block";
			errorMsg.style.color = "red";
			return;
		}

		try {

			if (url.includes("https://exclusivepromocode.com/")) {
				category = "exclusivePromocode";
			}
			if (url.includes("https://exclusive-promocode.com/rba/")) {
				category = "rba";
			} else {
				category = "autre";
			}

			console.log(category);

			let response = await fetch("https://script.google.com/macros/s/AKfycbxzzhWOe4SWEnNdkDSDFG2JnatCFphDwu-OTX1d6eK5T2mTevH48iY5J5b6AIGkU1ncFg/exec", {
                    method: "POST",
                    mode: "cors",
                    headers: { "Content-Type": "text/plain" },
                    body: JSON.stringify({ email: email, url: url, category: category })
                });

                let text = await response.text();
                let result = JSON.parse(text);

			successMsg.textContent = "Email registered successfully!";
			successMsg.style.color = "green";
			emailInput.value = "";

		} catch (error) {
			console.error("Error:", error);
			errorMsg.textContent = "An error occurred. Please try again later.";
			errorMsg.style.color = "red";
		}
	});
	</script>
</body>

</html>